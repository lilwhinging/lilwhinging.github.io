<!DOCTYPE html>
<html> 
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
 <head>
    <title>Spin-off of "Processing.JS inside Webpages: Template"</title> 
</head>
 <body>
	<!--This draws the Canvas on the webpage -->
      <canvas id="mycanvas"></canvas> 
 </body>
 
 <script src="https://cdn.jsdelivr.net/processing.js/1.4.8/processing.min.js"></script> 
 
 <script>
    var sketchProc = function(processingInstance) {
     with (processingInstance) {
        /**
 * falling
 * 
 * a game by littlewhinging
 * 
 * 992 lines of confused code ^-^
 * 
 * Spin-off proof is not required for the leaderboard, please be honest - and only post in the thread for the leaderboard scores.
 * 
 * Subscribe? It only takes a few seconds, it's free, and you can always unsubscribe.
 * https://www.khanacademy.org/computer-programming/littlewhingings-sub-page/6637078393733120
*/





/** Setup **/
//{
//jshint ignore: start
size(600, 600, 1);
var scene = "logo";
var lwPos = -100;
var finalePos = -600;
var lwPos2 = 500;
var clicked = false;
var transparencies1 = 0;
var transparencies2 = 255;
var transparencies3 = 0;
var score = 0;
function s (start, dest, amt){
    return start + ((dest-start)/amt);
}
//}

/** Graphics **/
//{
var Sign = (function(){
    background(0, 0);
    pushMatrix();
    translate(-160, -161);
    noStroke();
    rectMode(CENTER);
    fill(84, 42, 0);
    rect(200, 200, 10, 70, 10, 10, 0, 0);
    fill(143, 72, 0);
    pushMatrix();
    translate(200, 184);
    rotate(5*0.0174533);
    rect(0, 0, 61, 30, 10);
    fill(84, 42, 0);
    pushMatrix();
    translate(0, 3);
    rect(0, 3, 30, 10);
    triangle(-20, 3, -13, -6, -13, 11);
    popMatrix();
    textAlign(CENTER, CENTER);
    textFont(createFont("Montserrat"), 15);
    text("start", 2, -7);
    popMatrix();
    popMatrix();
    rectMode(CORNER);
    return get(0, 0, 76, 76);
})();
var BackgroundBase = (function(){
    background(5, 234, 255);
    
    //gradient
    for (var i = 0;i<300;i++){
        fill(255, 255, 255, i*6);
        noStroke();
        rect(0, i*10, 600, 10);
    }
    
    //sun
    fill(255, 255, 97);
    noStroke();
    ellipse(80, 80, 90, 90);
    fill(255, 244, 33);
    arc(80, 80, 90, 90, -90, 90);
    
    fill(107, 230, 0);
    triangle(600, 300, 624, 600, 0, 600);
    
    fill(91, 196, 0);
    triangle(0, 300, 744, 600, 0, 600);
    
    fill(75, 166, 0);
    beginShape();
        vertex(600, 600);
        bezierVertex(190, 135, 278, 612, 0, 347);
        vertex(0, 400);
        vertex(0, 600);
    endShape(CLOSE);


    return get(0, 0, 600, 400);
})();
var BackgroundBase2 = (function(){
    background(5, 234, 255);

    //gradient
    for (var i = 0;i<300;i++){
        fill(255, 255, 255, i*6);
        noStroke();
        rect(0, i*10, 600, 10);
    }
    
    //sun
    fill(255, 255, 97);
    noStroke();
    ellipse(80, 80, 90, 90);
    fill(255, 244, 33);
    arc(80, 80, 90, 90, -90, 90);
    
    fill(107, 230, 0);
    triangle(600, 300, 624, 600, 0, 600);
    
    fill(91, 196, 0);
    triangle(0, 300, 744, 600, 0, 600);
    
    fill(75, 166, 0);
    beginShape();
        vertex(600, 600);
        bezierVertex(190, 135, 278, 612, 0, 347);
        vertex(0, 400);
        vertex(0, 600);
    endShape(CLOSE);

    return get();
})();
function cloud(x, y, s){
    pushMatrix();
    translate(x, y);
    scale(s);
    fill(255, 255, 255);
    ellipse(246, 104, 40, 40);
    ellipse(298, 104, 40, 40);
    ellipse(271, 99, 50, 50);
    rect(242, 99, 56, 25);
    
    popMatrix();
}
var clouds = [
    {
        x: -55,
        y: 51,
        s: 1.5,
        speed: random(1, 2)
    },
    {
        x: 0,
        y: 0,
        s: 1,
        speed: random(1, 2)
    },
    {
        x: 154,
        y: -16,
        s: 1,
        speed: random(1, 2)
    },
    {
        x: 416,
        y: -16,
        s: 1,
        speed: random(1, 2)
    },
    {
        x: 492,
        y: 117,
        s: 0.4,
        speed: random(1, 2)
    },
    {
        x: 692,
        y: 52,
        s: 1.5,
        speed: random(1, 2)
    },
    {
        x: 612,
        y: -12,
        s: 1.3,
        speed: random(1, 2)
    },
];
//}

/** Animation **/
//{
/** Falling Text constructor **/
var FallingText = function(startingY,endingY,msg,x){
    this.msg = msg;
    this.endingY = endingY;
    this.txtArray = [];
    this.x = x;
    
    for (var i = 0;i<this.msg.length;i++){
        this.txtArray.push(startingY);
        this.spacing = this.x;
    }
};

/** Draw method**/
FallingText.prototype.draw = function() {
    var spacing = this.x;
    for (var i = 0;i<this.msg.length;i++) {
        fill(0, 455-this.txtArray[i]*2);
        pushMatrix();
        translate(spacing, this.txtArray[i]);
        scale(this.txtArray[i]/this.endingY);
        text(this.msg[i], 0, 0);
        popMatrix();
        spacing += textWidth(this.msg[i]);
    }
};

/** Animate **/
FallingText.prototype.animate = function() {
    for (var i = 0;i<this.msg.length;i++) {
        if (i === 0){
            this.txtArray[0] = lerp(this.txtArray[0], this.endingY, 0.1);
        }
        else if (this.txtArray[i-1]<this.endingY+60){
            this.txtArray[i] = lerp(this.txtArray[i], this.endingY, 0.1);
        }
    }
    this.done = this.txtArray[this.txtArray.length-1] < this.endingY + 1;
};
//}

/** User Interface **/
//{
var Button = function(x, y, w, h, msg){
    this.x = x;
    this.y = y;
    this.w = w;
    this.w2 = w;
    this.h = h;
    this.msg = msg;
};
Button.prototype.update = function(){
    this.inside = mouseX > this.x - this.w/2 && mouseX < this.x + this.w/2 && mouseY > this.y - this.h/2 && mouseY < this.y+this.h/2;
    this.triggered = this.inside && clicked;
};
Button.prototype.animate = function(){
    if (this.inside){
        this.w = lerp(this.w, this.w2*1.2, 0.1);
    }
    else {
        this.w = lerp(this.w, this.w2, 0.1);
    }
};
Button.prototype.draw = function() {
    rectMode(CENTER);
    textAlign(CENTER, CENTER);
    noFill();
    stroke(0);
    strokeWeight(this.w/40);
    pushMatrix();
    translate(this.x, this.y);
    scale(this.w/this.w2);
    rotate((this.w/this.w2)*360*5*0.0174533);
    rect(0, 0, this.w, this.h);
    fill(0);
    textFont(createFont("Montserrat"), 30);
    text(this.msg, 0, 0);
    popMatrix();
    rectMode(CORNER);
};
Button.prototype.pack = function(){
    this.update();
    this.draw();
    this.animate();
};
var keys = [];
//}

/** Game Logic **/
//{
var rrCol = function(obj1, obj2){
return obj1.x + obj1.w > obj2.x && obj1.x < obj2.x + obj2.w && obj1.y + obj1.h > obj2.y && obj1.y < obj2.y + obj2.h;
};

var Player = function(){
    this.x = 300;
    this.y = 20;
    this.yVel = 0;
    this.gravity = 0.3;
    this.timer = 0;
    this.eyeX = 0;
    this.w = 60;
    this.h = 60;
    this.timer2 = 0;
    this.canJump = false;
    this.score = 0;
};
Player.prototype.draw = function() {
    if (keys[LEFT]){
        this.eyeX = lerp(this.eyeX, -30, 0.1);
    }
    else if (keys[RIGHT]){
        this.eyeX = lerp(this.eyeX, 30, 0.1);
    }
    else {
        this.eyeX = lerp(this.eyeX, 0, 0.1);
    }
    
    noStroke();
    fill(0, 255, 0);
    rect(this.x, this.y, this.w, this.h, 10);
    fill(0, 255+this.eyeX*255/15);
    ellipse(this.x+15+this.eyeX, this.y+20, 10, 10);
    fill(0, 255-this.eyeX*255/15);
    ellipse(this.x+45+this.eyeX, this.y+20, 10, 10);
    noFill();
    stroke(0);
    strokeWeight(5);
    if (this.eyeX > 1){
        arc(this.x+30+this.eyeX, this.y+33, 20, 15, this.eyeX*3*0.0174533, 180*0.0174533);
    }
    else{
        arc(this.x+30+this.eyeX, this.y+33, 20, 15, 0, (180+this.eyeX*3)*0.0174533);
    }
    fill(0, 200, 0, 255+this.eyeX*255/15);
    noStroke();
    ellipse(this.x+this.eyeX, this.y+40+sin(frameCount*5*0.0174533)*5, 15, 25);
    fill(0, 200, 0, 255-this.eyeX*255/15);
    ellipse(this.x+60+this.eyeX, this.y+40+sin(frameCount*5*0.0174533+90*0.0174533)*5, 15, 25);
};
Player.prototype.moveY = function(){
    this.prevY = this.y;
    this.y+=this.yVel;
    this.yVel+=this.gravity;
    if (keys[UP] && this.canJump){
        this.yVel = -11;
        this.canJump = false;
    }
    this.y = constrain(this.y, -600, 540);
};
Player.prototype.moveX = function(){
    if (keys[32]){
        this.timer--;
        if (this.timer > 0){
            this.xVel = 10;
        }
        else {
            this.xVel = 5;        
        }
        this.timer2 = 0;
    }
    else {
        this.timer2++;
        this.xVel = 5;
        this.timer+=0.5;
    }
    this.timer = constrain(this.timer, 0, 100);
    this.prevX = this.x;
    if (keys[LEFT]){
        this.x -= this.xVel;
    }
    if (keys[RIGHT]){
        this.x += this.xVel;
    }
    this.x = constrain(this.x, 0, 540);
};

var blockVel = 0;
var Block = function(x, y, w, h, isGrass){
    this.x = x;
    this.y = y;
    this.yVel = 0;
    this.yPos = y;
    this.w = w;
    this.h = h;
    this.grass = isGrass;
    this.ellipses = [];
    for (var i = this.x;i<this.x+this.w;i+=random(10, 20)){
        this.ellipses.push([i, this.y]);
    }
};
Block.prototype.draw = function() {
    if (this.grass){
        fill(52, 143, 0);
        rect(this.x, this.y, this.w, this.h);
        for (var i = this.x;i<600;i+=10){
            triangle(i, this.y+1, i+5, this.y-8, i+10, this.y+1);
        }
    }
    else {
        fill(153, 77, 0);
        noStroke();
        rect(this.x, this.y, this.w, this.h);
        fill(84, 39, 0);
        for (var i = 0;i<this.ellipses.length;i++){
            ellipse(this.ellipses[i][0], this.ellipses[i][1], 10, 10);
        }
    }
};
Block.prototype.collideX = function(obj1){
    if (rrCol(this, obj1)){
        if(obj1.prevX < this.x) {
            obj1.x = this.x - obj1.w;
        }
        else if (obj1.x>this.x){
            obj1.x = this.x + this.w;
        }
    }
};
Block.prototype.collideY = function(obj1){
    this.y-=blockVel;
    
    if (rrCol(this,obj1)){
        obj1.canJump = true;
        
        if(obj1.y < this.y) {
            obj1.y = this.y - obj1.h;
            obj1.gravity = 0;
            if (!keys[UP]){
                obj1.yVel = 0;
            }
        } 
        
        else if (obj1.y>this.y){
            obj1.y = this.y + this.h;
            obj1.canJump = false;
            obj1.yVel *= -1;
        }
    }
    
};

var Coin = function(x, y, w, h){
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;
};
Coin.prototype.draw = function() {
     pushMatrix();
     translate(this.x+this.w/2, this.y+this.h/2);
     noStroke();
     fill(255, 255, 0);
     ellipse(0, 0, this.w*sin(frameCount*3), this.h);
     fill(255, 230, 0);
     ellipse(0, 0, this.w*0.8*sin(frameCount*3), this.h*0.8);
     popMatrix();
};
Coin.prototype.collide = function(obj){
    this.y -= blockVel;
    if (rrCol(this, obj)){
        this.x = -1000;
        score+=60;
    }
};

//}

/** Game setup **/
//{
var player = new Player();
var blocks = [new Block(100, 370, 500, 50, true)];
var coins = [];
var gapPos = random(0, 500);
//}

/** Graphics **/
//{
var AnimatedBackground = function(){
    image(BackgroundBase, 0, 0);
    fill(255, 255, 97);
        noStroke();
    for (var i = 0;i<360;i+=30){
        pushMatrix();
        translate(80, 80);
        rotate((i+frameCount/3)*0.0174533);
        translate(-80, -73);
        triangle(80, 5, 65, 30, 95, 30);
        popMatrix();
    }
    fill(255, 244, 33);
    arc(80, 80, 90, 90, -90, 90);
    for (var i = 0;i<360;i+=30){
        pushMatrix();
        translate(80, 80);
        rotate((i+frameCount/3)*0.0174533);
        translate(-80, -73);
        triangle(80, 5, 80, 30, 95, 30);
        popMatrix();
    }
    for (var i = 0;i<clouds.length;i++){
        cloud(clouds[i].x, clouds[i].y, clouds[i].s);
        clouds[i].x -= clouds[i].speed;
        if (clouds[i].x<-650){
            clouds[i].x = 800;
        }
    }
};
var AnimatedBackground2 = function(){
    image(BackgroundBase2, 0, 0);
    fill(255, 255, 97);
        noStroke();
    for (var i = 0;i<360;i+=30){
        pushMatrix();
        translate(80, 80);
        rotate((i+frameCount/3)*0.0174533);
        translate(-80, -73);
        triangle(80, 5, 65, 30, 95, 30);
        popMatrix();
    }
    fill(255, 244, 33);
    arc(80, 80, 90, 90, -90, 90);
    for (var i = 0;i<360;i+=30){
        pushMatrix();
        translate(80, 80);
        rotate((i+frameCount/3)*0.0174533);
        translate(-80, -73);
        triangle(80, 5, 80, 30, 95, 30);
        popMatrix();
    }
    for (var i = 0;i<clouds.length;i++){
        cloud(clouds[i].x, clouds[i].y, clouds[i].s);
        clouds[i].x -= clouds[i].speed;
        if (clouds[i].x<-650){
            clouds[i].x = 800;
        }
    }
};
//}

/** Main Scenes **/
//{
var game = (function() {
    var gameTrans = 255;
    var gameTriggered = false;
    return function(){
    if (blocks[blocks.length-1].y < 500){
        blocks.push(new Block(0, 650, gapPos, 50, false));
        blocks.push(new Block(gapPos+100, 650, 600-gapPos, 50, false));
        if (floor(random(0, 5)) === 4){
            coins.push(new Coin(random(0, 540), 600, 30, 30));
        }
        gapPos = random(0, 500);
    }
    
    background(94, 52, 0);
    pushMatrix();
    translate(0, blocks[0].y-375);
    AnimatedBackground();
    image(Sign, 96, 301);
    popMatrix();
    player.draw();
    player.moveX();
    for (var i = blocks.length-1;i>=0;i--){
        blocks[i].draw();
        blocks[i].collideX(player);
    }
    player.moveY();
    player.gravity = 0.3;
    for (var i = blocks.length-1;i>=0;i--){
        blocks[i].collideY(player);
        if (blocks[i].y < -600){
            blocks.splice(i, 1);
        }
    }
    for (var i = coins.length-1;i>=0;i--){
        coins[i].draw();
        coins[i].collide(player);
    }
    blockVel+=0.001;
    for (var i = 0;i<player.timer;i+=5){
        fill(lerpColor(color(255, 0, 0), color(0, 255, 0), i/100));
        rect(i+500, 0, 5, 30);
    }
    fill(0, 0, 0);
    textSize(40);
    textAlign(LEFT, CENTER);
    text(floor(score), 10, 20);
    score+=0.1;
    fill(0, gameTrans);
    rect(0, 0, 600, 600);
    if (!gameTriggered){
        gameTrans = lerp(gameTrans, 0, 0.1);
    }
    else {
        gameTrans = lerp(gameTrans, 256, 0.1);
    }
    if (player.y < -30){
        gameTriggered = true;
    }
    if (gameTrans > 255){
        gameTriggered = false;
        gameTrans = 255;
        player = new Player();
        blocks = [new Block(100, 370, 500, 50, true)];
        coins = [];
        gapPos = random(0, 500);
        scene = "ded";
        blockVel = 0;
    }
    };
})();
var logo = function(){
    //its a me mario{
        pushMatrix();
        scale(1.5);
        background(0, 163, 0);
        fill(255, 255, 255);
        textFont(createFont("Montserrat"), 50);
        pushMatrix();
        translate(200, lwPos);
        rotate((lwPos-200)*2*0.0174533);
        scale((lwPos/400+0.4));
        text('DISSENSION', 0, 0);
        popMatrix();
        textSize(20);
        text('studios', 200, lwPos2-80);
        lwPos = s(lwPos, 200, 8);
        stroke(255, 255, 255);
        strokeWeight(3);
        if (lwPos2 !== 500){
            line(200-(lwPos2-500)/1.1, 170, 200+(lwPos2-500)/1.1, 170);
            line(200-(lwPos2-500)/1.1, 235, 200+(lwPos2-500)/1.1, 235);
        }
        if (lwPos > 199.9){
            lwPos2 = s(lwPos2, 340, 10);
        }
        if (lwPos2 < 340.01){
            transparencies1 = lerp(transparencies1, 255, 0.1);
        }
        if (transparencies1 > 254){
            scene = "menu";
        }
        fill(0, transparencies1);
        noStroke();
        rect(0, 0, 400, 400);
        popMatrix();
        
    //}
};
var uded = (function(){
    var udedpos = -300;
    var transparencyded = 255;
    var p2 = -300;
    var dedTriggered = false;
    var backBtn = new Button(300, 700, 200, 100, "back");
    return function(){
        AnimatedBackground2();
        fill(0);
        textFont(createFont("Montserrat"), 100);
        text("you died", 300, udedpos);
        textSize(50);
        text("with a score of "+floor(score), p2, 300);
        fill(0, transparencyded);
        rect(0, 0, 600, 600);
        if (!dedTriggered){
            transparencyded = lerp(transparencyded, 0, 0.1);
        }
        else {
            transparencyded = lerp(transparencyded, 256, 0.1);
        }
        if (transparencyded > 255){
            udedpos = -300;
            transparencyded = 255;
            p2 = -300;
            dedTriggered = false;
            score = 0;
            backBtn = new Button(300, 700, 200, 100, "back");
            scene = "menu";
        }
        if (transparencyded < 1){
            udedpos = lerp(udedpos, 100, 0.1);
        }
        if (udedpos > 99){
            p2 = lerp(p2, 300, 0.1);
        }
        if (p2 > 299){
            backBtn.y = lerp(backBtn.y, 500, 0.1);
        }
        backBtn.pack();
        if (backBtn.triggered){
            dedTriggered = true;
        }
    };
})();
var how = (function(){
    var udedpos = -300;
    var transparencyded = 255;
    var p2 = -300;
    var dedTriggered = false;
    var backBtn = new Button(300, 700, 200, 100, "back");
    return function(){
        AnimatedBackground2();
        fill(0);
        textFont(createFont("Montserrat"), 90);
        text("how to play", 300, udedpos);
        textSize(30);
        text("- move with arrow keys\n- don't be pushed to the top\n- press space to boost\n- collect coins", p2, 300);
        fill(0, transparencyded);
        rect(0, 0, 600, 600);
        if (!dedTriggered){
            transparencyded = lerp(transparencyded, 0, 0.1);
        }
        else {
            transparencyded = lerp(transparencyded, 256, 0.1);
        }
        if (transparencyded > 255){
            udedpos = -300;
            transparencyded = 255;
            p2 = -300;
            dedTriggered = false;
            score = 0;
            backBtn = new Button(300, 700, 200, 100, "back");
            scene = "menu";
        }
        if (transparencyded < 1){
            udedpos = lerp(udedpos, 100, 0.1);
        }
        if (udedpos > 99){
            p2 = lerp(p2, 300, 0.1);
        }
        if (p2 > 299){
            backBtn.y = lerp(backBtn.y, 500, 0.1);
        }
        backBtn.pack();
        if (backBtn.triggered){
            dedTriggered = true;
        }
    };
})();
var menu = (function(){
    var myText = new FallingText(300, 100, "falling", 150);
    var playBtn = new Button(-300, 300, 200, 100, "play");
    var howBtn = new Button(900, 425, 200, 100, "how");
    var playTriggered = false;
    var howTriggered = false;
    var leadTriggered = false;
    var transparencies = [0, 0, 0];
    return function(){
        AnimatedBackground2();
        fill(0, transparencies2);
        noStroke();
        rect(0, 0, 600, 600);
        transparencies2 = lerp(transparencies2, 0, 0.1);
        fill(0);
        textFont(createFont("Montserrat"), 100);
        textAlign(CORNER, CORNER);
        pushMatrix();
        translate(0, 50);
        myText.draw();
        if (transparencies2 < 1){
            myText.animate();
        }
        popMatrix();
        
        playBtn.draw();
        playBtn.update();
        playBtn.animate();
        
        howBtn.draw();
        howBtn.update();
        howBtn.animate();
        
        if (myText.done){
            playBtn.x = lerp(playBtn.x, 300, 0.1);
            howBtn.x = lerp(howBtn.x, 300, 0.1);
        }
        if (playBtn.triggered){
            playTriggered = true;
        }
        if (howBtn.triggered){
            howTriggered = true;
        }
        if (playTriggered){
            transparencies[0] = lerp(transparencies[0], 255, 0.1);
        }
        if (howTriggered){
            transparencies[1] = lerp(transparencies[1], 255, 0.1);
        }
        noStroke();
        for (var i = 0;i<transparencies.length;i++){
            fill(0, transparencies[i]);
            rect(0, 0, 600, 600);
        }
        if (transparencies[0] > 254){
            myText = new FallingText(300, 100, "falling", 150);
            playBtn = new Button(-300, 300, 200, 100, "play");
            howBtn = new Button(900, 425, 200, 100, "how");
            playTriggered = false;
            howTriggered = false;
            leadTriggered = false;
            transparencies = [0, 0, 0];
            transparencies2 = 255;
            scene = "game";
        }
        if (transparencies[1] > 254){
            myText = new FallingText(300, 100, "falling", 150);
            playBtn = new Button(-300, 300, 200, 100, "play");
            howBtn = new Button(900, 425, 200, 100, "how");
            playTriggered = false;
            howTriggered = false;
            leadTriggered = false;
            transparencies = [0, 0, 0];
            transparencies2 = 255;
            scene = "how";
        }
    };
})();
var main = function() {
    switch(scene){
        case "logo":
            logo();
        break;
        case "menu":
            menu();
        break;
        case "game":
            game();
        break;
        case "ded":
            uded();
        break;
        case "how":
            how();
        break;
    }
    clicked = false;
};
//}

/** Processing JS functions **/
//{
draw = function() {
    main();
};
keyPressed = function(){
    keys[keyCode] = true;
};
keyReleased = function(){
    keys[keyCode] = false;
};

mouseClicked = function(){
    clicked = true;
};
    }};

    // Get the canvas that Processing-js will use
    var canvas = document.getElementById("mycanvas"); 
    // Pass the function sketchProc (defined in myCode.js) to Processing's constructor.
    var processingInstance = new Processing(canvas, sketchProc); 
 </script>

</html>
